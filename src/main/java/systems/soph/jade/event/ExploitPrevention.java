package systems.soph.jade.event;

import io.papermc.paper.event.player.AsyncChatEvent;
import net.kyori.adventure.text.Component;
import org.bukkit.Material;
import org.bukkit.entity.Player;
import org.bukkit.event.EventHandler;
import org.bukkit.event.EventPriority;
import org.bukkit.event.Listener;
import org.bukkit.event.inventory.InventoryType;
import org.bukkit.event.player.PlayerCommandPreprocessEvent;
import systems.soph.jade.Jade;
import systems.soph.jade.Palette;
import systems.soph.jade.staff.StaffManager;

public class ExploitPrevention implements Listener {

    public ExploitPrevention(Jade plugin) {
        plugin.getServer().getPluginManager().registerEvents(this, plugin);
    }

    @EventHandler(priority = EventPriority.HIGHEST)
    public void onChat(AsyncChatEvent event) {
        if (event.getPlayer().getItemOnCursor().getType() != Material.AIR) {
            event.setCancelled(true);
            alert(event.getPlayer().getName());
        }
    }

    @EventHandler(priority = EventPriority.HIGHEST)
    public void onCommand(PlayerCommandPreprocessEvent event) {
        if (event.getPlayer().getItemOnCursor().getType() != Material.AIR) {
            event.setCancelled(true);
            alert(event.getPlayer().getName());
        }
    }

    public void alert(String name) {
        StaffManager.alert(Component.text(name + " was flagged for potential exploit usage.")
                .color(Palette.ERROR));
    }

    public static void clearCraftingGrid(Player player) {
        if (player.getOpenInventory().getTopInventory().getType() != InventoryType.CRAFTING) return;
        if (player.getOpenInventory().getTopInventory().getSize() > 5) return;
        player.getOpenInventory().getTopInventory().clear();
    }

}
